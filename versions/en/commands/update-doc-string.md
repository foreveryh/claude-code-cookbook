## Update Doc String

Systematically manages multi-language docstrings/comments and maintains high-quality documentation.

### Usage

```bash
# Auto-detect language and execute
"Add docstrings to classes/functions without them and update comments that don't meet standards"

# Execute with specified language
/update-doc-string --lang python
"Update Python file docstrings to be PEP 257 compliant"

# Document specific directory
"Add JSDoc to functions under src/components/"
```

### Options

- `--lang <en|ja>`: Documentation language (default: auto-detect from existing comments, otherwise en)
- `--style <style>`: Documentation style (language-specific defaults available)
- `--marker <true|false>`: Whether to add Claude marker (default: true)

### Basic Examples

```bash
# 1. Analyze target files (programming language auto-detected)
find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.dart" -o -name "*.go" -o -name "*.rs" \) | grep -v test
"Identify elements lacking docstrings (0 comment lines or less than 30 characters)"

# 2. Add documentation (language auto-detected)
"Add docstrings with language-specific required elements to identified elements"
# → If existing comments contain Japanese, write in Japanese, otherwise in English

# 3. Add documentation (explicitly specify English)
/update-doc-string --lang en
"Add docstrings with required elements to the identified elements"

# 4. Verify markers
"Confirm all added/updated docstrings have Claude markers"
```

### Execution Steps

#### 1. Target Element Priority

1. 🔴 **Highest Priority**: Elements without docstrings/comments (0 comment lines)
2. 🟡 **Next Priority**: Elements not meeting standards (< 30 characters or missing required elements)
3. 🟢 **Review Target**: Existing comments without Claude marker

**Target Elements (Common across languages)**:
- Class definitions
- Functions/methods
- Modules (Python, Go)
- Enums
- Interfaces (TypeScript, Go)

#### 2. Language-Specific Documentation Rules

**Python (PEP 257)**:
```python
# Japanese version (default)
def calculate_total(items: List[Item]) -> float:
    """アイテムリストの合計金額を計算します。(30-60 chars)
    
    各アイテムの価格と数量を掛け合わせ、税込み合計を返します。
    空のリストの場合は0.0を返します。(50-200 chars)
    
    Args:
        items: 計算対象のアイテムリスト
        
    Returns:
        税込み合計金額
        
    Generated by Claude 🤖
    """

# English version (--lang en)
def calculate_total(items: List[Item]) -> float:
    """Calculate the total amount for a list of items. (30-60 chars)
    
    Multiplies the price and quantity of each item and returns
    the total with tax. Returns 0.0 for empty lists. (50-200 chars)
    
    Args:
        items: List of items to calculate
        
    Returns:
        Total amount with tax
        
    Generated by Claude 🤖
    """
```

**JavaScript/TypeScript (JSDoc)**:
```javascript
/**
 * Component to display user profile. (30-60 chars)
 * 
 * Displays avatar image, username, and status info,
 * navigates to profile details on click. (50-200 chars)
 * 
 * @param {Object} props - Component properties
 * @param {string} props.userId - User ID
 * @param {boolean} [props.showStatus=true] - Status display flag
 * @returns {JSX.Element} Rendered component
 * 
 * @generated by Claude 🤖
 */
const UserProfile = ({ userId, showStatus = true }) => {
```

**Go**:
```go
// CalculateTotal calculates the total amount for an item list. (30-60 chars)
//
// Multiplies price and quantity for each item and returns the total
// with tax. Returns 0.0 for empty slices. (50-200 chars)
//
// Generated by Claude 🤖
func CalculateTotal(items []Item) float64 {
```

**Rust**:
```rust
/// Calculates the total amount for an item list. (30-60 chars)
///
/// Multiplies price and quantity for each item and returns
/// the total with tax. Returns 0.0 for empty vectors. (50-200 chars)
///
/// Generated by Claude 🤖
pub fn calculate_total(items: &[Item]) -> f64 {
```

**Dart (DartDoc)**:
```dart
/// Widget to display user profile. (30-60 chars)
///
/// Displays avatar image, username, and status info vertically,
/// navigates to profile details screen on tap. (50-200 chars)
///
/// Generated by Claude 🤖
class UserProfileWidget extends StatelessWidget {
```

#### 3. Existing Content Preservation Rules

1. **Existing comments meet standards**: Keep as-is (don't add new)
   - Criteria: 30+ characters AND includes required elements (summary, details, marker)
2. **Existing comments don't meet standards**: Replace completely (avoid duplication)
3. **No existing comments**: Add new comment

**Important info to preserve**:
- URLs and links: `See also:`, `@see`, `Reference:` etc.
- TODO comments: `TODO:`, `FIXME:`, `XXX:` format
- Notes: `Note:`, `Warning:`, etc.
- Usage examples: `Example:`, `# Examples` etc.
- Existing parameter/return value descriptions

### Language-Specific Settings

```yaml
# Language-specific default settings
languages:
  python:
    style: "google"  # google, numpy, sphinx
    indent: 4
    quotes: '"""'
  javascript:
    style: "jsdoc"
    indent: 2
    prefix: "/**"
    suffix: "*/"
  typescript:
    style: "tsdoc"
    indent: 2
    prefix: "/**"
    suffix: "*/"
  go:
    style: "godoc"
    indent: 0
    prefix: "//"
  rust:
    style: "rustdoc"
    indent: 0
    prefix: "///"
  dart:
    style: "dartdoc"
    indent: 0
    prefix: "///"
```

### Quality Checklist

- ✅ **Character count**: Summary 30-60 chars, details 50-200 chars strictly enforced
- ✅ **Required elements**: Must include summary, details, and Claude marker
- ✅ **Completeness**: Include role, usage context, and important notes
- ✅ **Language conventions**: Comply with official style guides for each language
- ✅ **Exceptions**: Document errors and exceptions (when applicable)
- ✅ **Accuracy**: Analyze implementation and document only facts

### Important Notes

**🔴 Strictly Prohibited**:
- ❌ Code changes other than documentation comments
- ❌ Speculation about implementation details (facts only)
- ❌ Formatting against language conventions
- ❌ Deleting/changing existing type annotations
- ❌ Duplicating existing comments
- ❌ Sub-standard comments in test files

**Execution and Validation**:
```bash
# Record execution results
ADDED_COMMENTS=0
UPDATED_COMMENTS=0
ERRORS=0

# Auto-detect language from existing comments
# If Japanese characters (hiragana/katakana/kanji) detected, use ja, otherwise en
DOC_LANGUAGE="en"  # default
if grep -r '[ぁ-んァ-ヶー一-龠]' --include="*.py" --include="*.js" --include="*.ts" --include="*.dart" --include="*.go" --include="*.rs" . 2>/dev/null | head -n 1; then
  DOC_LANGUAGE="ja"
fi

# Auto-detect programming language and run static analysis
if [ -f "*.py" ]; then
  pylint --disable=all --enable=missing-docstring .
elif [ -f "*.js" ] || [ -f "*.ts" ]; then
  eslint . --rule 'jsdoc/require-jsdoc: error'
elif [ -f "*.go" ]; then
  golint ./...
elif [ -f "*.rs" ]; then
  cargo doc --no-deps
elif [ -f "*.dart" ]; then
  melos analyze
fi

if [ $? -ne 0 ]; then
  echo "🔴 Error: Static analysis failed"
  exit 1
fi

# Output execution summary
echo "📊 Execution results:"
echo "- Documentation language: $DOC_LANGUAGE"
echo "- Added comments: $ADDED_COMMENTS"
echo "- Updated comments: $UPDATED_COMMENTS"
echo "- Errors: $ERRORS"
```

### Success Criteria

1. **Complete Success**: All criteria met
   - Language-specific static analysis PASSED
   - 0 errors
   - All added/updated comments meet standards

2. **Partial Success**:
   - < 5 errors
   - 90%+ meet standards

3. **Failed**:
   - Static analysis FAILED
   - 5+ errors

### Claude Integration

```bash
# Analyze entire project (auto-detect language)
find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" \)
/update-doc-string
"Update this project's docstrings following language-specific best practices"
# → If existing comments contain Japanese, execute in ja, otherwise en

# Explicitly execute with English documentation
/update-doc-string --lang en
"Update docstrings following language-specific best practices"

# Explicitly execute with Japanese documentation
/update-doc-string --lang ja
"このプロジェクトのdocstringを言語別のベストプラクティスに従って更新して"

# Execute without marker (auto-detect language)
/update-doc-string --marker false
"Improve existing docstrings without adding Claude markers"

# English documentation, no marker
/update-doc-string --lang en --marker false
"Improve existing docstrings without adding Claude markers"
```
