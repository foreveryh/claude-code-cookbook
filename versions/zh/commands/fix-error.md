## 错误修复

从错误信息中识别根本原因，提出经过验证的解决方案。

### 使用方法

```bash
/fix-error [选项]
```

### 选项

- 无 : 标准错误分析
- `--deep` : 深度分析模式（包括依赖关系·环境因素）
- `--preventive` : 重视预防措施的分析
- `--quick` : 仅提供立即可用的修复方案

### 基本示例

```bash
# 标准错误分析
npm run build 2>&1
/fix-error
"分析构建错误并提出修复方法"

# 深度分析模式
python app.py 2>&1
/fix-error --deep
"包括环境因素在内分析错误的根本原因"

# 即时修复重视
cargo test 2>&1
/fix-error --quick
"提供可立即应用的修复方法"

# 预防措施重视
./app 2>&1 | tail -50
/fix-error --preventive
"提出错误修复和未来的预防措施"
```

### 与 Claude 的协作

```bash
# 错误日志分析
cat error.log
/fix-error
"识别错误的根本原因，提出修复方法"

# 测试失败的解决
npm test 2>&1
/fix-error --quick
"分析失败的测试，提出可立即应用的修复方案"

# 堆栈跟踪的解析
python script.py 2>&1
/fix-error --deep
"从这个堆栈跟踪中定位问题，包括环境因素一起分析"

# 批量解决多个错误
grep -E "ERROR|WARN" app.log | tail -20
/fix-error
"按优先级分类这些错误和警告，分别提出解决方法"
```

### 错误分析的优先级

#### 紧急度: 高（需立即处理）

- **应用程序停止**: 崩溃、无限循环、死锁
- **数据丢失风险**: 数据库错误、文件损坏
- **安全漏洞**: 认证失败、权限错误、注入攻击
- **生产环境影响**: 部署失败、服务停止

#### 🟡 紧急度: 中（建议尽早处理）

- **性能问题**: 内存泄漏、延迟、超时
- **部分功能失效**: 特定功能错误、UI 故障
- **开发效率下降**: 构建错误、测试失败

#### 🟢 紧急度: 低（计划处理）

- **警告信息**: deprecation、lint 错误
- **仅限开发环境**: 仅本地环境的问题
- **未来风险**: 技术债务、可维护性问题

### 分析流程

#### 阶段 1: 错误信息收集

```bash
🔴 必须执行:
- 完整获取错误信息
- 确认堆栈跟踪
- 确定发生条件（可重现性）

🟡 尽早执行:
- 收集环境信息（OS、版本、依赖）
- 最近的更改历史（git log、最近提交）
- 确认相关日志

🟢 附加执行:
- 系统资源状况
- 网络状态
- 外部服务状态
```

#### 阶段 2: 根本原因分析

1. **整理表面症状**
   - 错误信息的准确内容
   - 发生时机和模式
   - 确定影响范围

2. **识别深层原因**
   - 应用 5 Whys 分析
   - 追踪依赖关系
   - 确认环境差异

3. **验证假设**
   - 创建最小重现代码
   - 执行隔离测试
   - 缩小原因范围

#### 阶段 3: 实施解决方案

```bash
🔴 立即处理（热修复）:
- 抑制症状的最小修复
- 应用临时解决方案
- 准备紧急部署

🟡 根本解决:
- 针对原因的本质修复
- 添加测试用例
- 更新文档

🟢 实施预防措施:
- 加强错误处理
- 设置监控·告警
- 改进 CI/CD 管道
```

### 输出示例

```
🚨 错误分析报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 错误概要
├─ 类型: [编译/运行时/逻辑/环境]
├─ 紧急度: 🔴 高 / 🟡 中 / 🟢 低
├─ 影响范围: [功能名/组件]
└─ 重现性: [100% / 间歇性 / 特定条件]

🔍 根本原因
├─ 直接原因: [具体原因]
├─ 背景因素: [环境/设置/依赖关系]
└─ 触发器: [发生条件]

💡 解决方案
🔴 立即处理:
1. [具体修复命令/代码]
2. [临时解决方案]

🟡 根本解决:
1. [本质修复方法]
2. [必要的重构]

🟢 预防措施:
1. [错误处理改进]
2. [测试添加]
3. [监控设置]

📝 验证步骤
1. [修复后的确认方法]
2. [测试执行命令]
3. [功能确认项目]
```

### 错误类型别分析方法

#### 编译/构建错误

```bash
# TypeScript 类型错误
必须确认（高）:
- tsconfig.json 设置
- 类型定义文件（.d.ts）存在
- import 语句的准确性

# Rust 生命周期错误
必须确认（高）:
- 所有权转移
- 引用的有效期
- 可变性冲突
```

#### 运行时错误

```bash
# Null/Undefined 引用
必须确认（高）:
- 可选链不足
- 初始化时机
- 异步处理的完成等待

# 内存相关错误
必须确认（高）:
- 获取堆转储
- 分析 GC 日志
- 检测循环引用
```

#### 依赖关系错误

```bash
# 版本冲突
必须确认（高）:
- lock 文件的一致性
- peer dependencies 的要求
- 传递依赖关系

# 模块解析错误
必须确认（高）:
- NODE_PATH 设置
- 路径别名设置
- 符号链接
```

### 注意事项

- **绝对禁止**: 仅凭部分错误信息判断、未经验证就应用 Stack Overflow 的解决方案
- **例外条件**: 临时解决方案仅在以下 3 个条件下允许
  1. 生产环境紧急响应（24 小时内必须根本解决）
  2. 外部服务故障（等待恢复期间的替代手段）
  3. 已知框架 bug（等待修复版本发布）
- **建议事项**: 优先识别根本原因，避免表面修复

### 最佳实践

1. **完整信息收集**: 确认错误信息从头到尾
2. **确认重现性**: 优先创建最小重现代码
3. **渐进式方法**: 从小修复开始验证
4. **文档化**: 记录解决过程以便知识共享

#### 常见陷阱

- **处理症状**: 表面修复忽略根本原因
- **过度泛化**: 将特定案例的解决方案广泛应用
- **省略验证**: 不确认修复后的副作用
- **知识孤岛**: 不记录解决方法

### 相关命令

- `/design-patterns` : 分析代码结构问题并提出模式建议
- `/tech-debt` : 从技术债务角度分析错误的根本原因
- `/analyzer` : 需要更深入的根本原因分析时使用
