## 錯誤修復

從錯誤資訊中識別根本原因，提出經過驗證的解決方案。

### 使用方法

```bash
/fix-error [選項]
```

### 選項

- 無 : 標準錯誤分析
- `--deep` : 深度分析模式（包括依賴關系·環境因素）
- `--preventive` : 重視預防措施的分析
- `--quick` : 仅提供立即可用的修復方案

### 基本示例

```bash
# 標準錯誤分析
npm run build 2>&1
/fix-error
"分析構建錯誤並提出修復方法"

# 深度分析模式
python app.py 2>&1
/fix-error --deep
"包括環境因素在內分析錯誤的根本原因"

# 即時修復重視
cargo test 2>&1
/fix-error --quick
"提供可立即應用的修復方法"

# 預防措施重視
./app 2>&1 | tail -50
/fix-error --preventive
"提出錯誤修復和未來的預防措施"
```

### 與 Claude 的協作

```bash
# 錯誤日誌分析
cat error.log
/fix-error
"識別錯誤的根本原因，提出修復方法"

# 測試失败的解決
npm test 2>&1
/fix-error --quick
"分析失败的測試，提出可立即應用的修復方案"

# 堆棧跟蹤的解析
python script.py 2>&1
/fix-error --deep
"從這個堆棧跟蹤中定位問題，包括環境因素一起分析"

# 批量解決多個錯誤
grep -E "ERROR|WARN" app.log | tail -20
/fix-error
"按優先級分類這些錯誤和警告，分別提出解決方法"
```

### 錯誤分析的優先級

#### 紧急度: 高（需立即處理）

- **應用程序停止**: 崩溃、無限循環、死鎖
- **數據丢失風險**: 數據庫錯誤、文件损坏
- **安全漏洞**: 認證失败、權限錯誤、注入攻擊
- **生產環境影響**: 部署失败、服務停止

#### 🟡 紧急度: 中（建議尽早處理）

- **性能問題**: 內存洩漏、延遲、超時
- **部分功能失效**: 特定功能錯誤、UI 故障
- **開發效率下降**: 構建錯誤、測試失败

#### 🟢 紧急度: 低（計劃處理）

- **警告資訊**: deprecation、lint 錯誤
- **仅限開發環境**: 仅本地環境的問題
- **未來風險**: 技術债務、可維護性問題

### 分析流程

#### 阶段 1: 錯誤資訊收集

```bash
🔴 必须執行:
- 完整獲取錯誤資訊
- 確認堆棧跟蹤
- 確定發生條件（可重現性）

🟡 尽早執行:
- 收集環境資訊（OS、版本、依賴）
- 最近的更改歷史（git log、最近提交）
- 確認相關日誌

🟢 附加執行:
- 系統資源狀况
- 網絡狀態
- 外部服務狀態
```

#### 阶段 2: 根本原因分析

1. **整理表面症狀**
   - 錯誤資訊的準確內容
   - 發生時機和模式
   - 確定影響範圍

2. **識別深層原因**
   - 應用 5 Whys 分析
   - 追蹤依賴關系
   - 確認環境差異

3. **驗證假設**
   - 創建最小重現代碼
   - 執行隔離測試
   - 縮小原因範圍

#### 阶段 3: 實施解決方案

```bash
🔴 立即處理（熱修復）:
- 抑制症狀的最小修復
- 應用临時解決方案
- 準備紧急部署

🟡 根本解決:
- 针對原因的本質修復
- 添加測試用例
- 更新文檔

🟢 實施預防措施:
- 加強錯誤處理
- 設置監控·告警
- 改進 CI/CD 管道
```

### 輸出示例

```
🚨 錯誤分析報告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📍 錯誤概要
├─ 類型: [編譯/運行時/邏輯/環境]
├─ 紧急度: 🔴 高 / 🟡 中 / 🟢 低
├─ 影響範圍: [功能名/組件]
└─ 重現性: [100% / 間歇性 / 特定條件]

🔍 根本原因
├─ 直接原因: [具體原因]
├─ 背景因素: [環境/設置/依賴關系]
└─ 觸發器: [發生條件]

💡 解決方案
🔴 立即處理:
1. [具體修復命令/代碼]
2. [临時解決方案]

🟡 根本解決:
1. [本質修復方法]
2. [必要的重構]

🟢 預防措施:
1. [錯誤處理改進]
2. [測試添加]
3. [監控設置]

📝 驗證步骤
1. [修復後的確認方法]
2. [測試執行命令]
3. [功能確認項目]
```

### 錯誤類型別分析方法

#### 編譯/構建錯誤

```bash
# TypeScript 類型錯誤
必须確認（高）:
- tsconfig.json 設置
- 類型定義文件（.d.ts）存在
- import 語句的準確性

# Rust 生命週期錯誤
必须確認（高）:
- 所有權轉移
- 引用的有效期
- 可變性衝突
```

#### 運行時錯誤

```bash
# Null/Undefined 引用
必须確認（高）:
- 可選鏈不足
- 初始化時機
- 異步處理的完成等待

# 內存相關錯誤
必须確認（高）:
- 獲取堆轉儲
- 分析 GC 日誌
- 檢測循環引用
```

#### 依賴關系錯誤

```bash
# 版本衝突
必须確認（高）:
- lock 文件的一致性
- peer dependencies 的要求
- 傳遞依賴關系

# 模塊解析錯誤
必须確認（高）:
- NODE_PATH 設置
- 路徑別名設置
- 符号鏈接
```

### 注意事項

- **绝對禁止**: 仅凭部分錯誤資訊判斷、未經驗證就應用 Stack Overflow 的解決方案
- **例外條件**: 临時解決方案仅在以下 3 個條件下允许
  1. 生產環境紧急響應（24 小時內必须根本解決）
  2. 外部服務故障（等待恢復期間的替代手段）
  3. 已知框架 bug（等待修復版本發布）
- **建議事項**: 優先識別根本原因，避免表面修復

### 最佳實践

1. **完整資訊收集**: 確認錯誤資訊從头到尾
2. **確認重現性**: 優先創建最小重現代碼
3. **渐進式方法**: 從小修復開始驗證
4. **文檔化**: 記錄解決過程以便知識共享

#### 常見陷阱

- **處理症狀**: 表面修復忽略根本原因
- **過度泛化**: 將特定案例的解決方案廣泛應用
- **省略驗證**: 不確認修復後的副作用
- **知識孤岛**: 不記錄解決方法

### 相關命令

- `/design-patterns` : 分析代碼結構問題並提出模式建議
- `/tech-debt` : 從技術债務角度分析錯誤的根本原因
- `/analyzer` : 需要更深入的根本原因分析時使用
